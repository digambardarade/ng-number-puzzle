<div class="container" [ngClass]="themeClass">
   <div class="content" mt-5>
    <div class="left">
      <!-- Mobile-only compact stats above the board -->
      <div class="stats mobile-stats" aria-label="Current moves and time">
        <div class="stat-item" aria-live="polite">
          <span class="stat-label">Moves</span>
          <span class="stat-value">{{ moveCount }}</span>
        </div>
        <div class="stat-item" aria-live="polite">
          <span class="stat-label">Time</span>
          <span class="stat-value monospace">{{ formatTime(elapsedMs) }}</span>
        </div>
      </div>
      <div
        class="board"
        [ngStyle]="dimensionStyle"
        aria-label="Sliding puzzle board"
      >
        <div
          class="board-overlay"
          *ngIf="paused || stopped"
          [class.is-paused]="paused"
          [class.is-stopped]="stopped"
        >
          <span class="overlay-label">{{ paused ? "Paused" : "Stopped" }}</span>
        </div>
        <button
          class="tile"
          *ngFor="let tile of tiles; let i = index"
          [class.empty]="tile === 0"
          [class.moved]="i === lastMovedIndex"
          [disabled]="
            tile === 0 || !canMove(i) || isSolved() || paused || stopped
          "
          (click)="move(i)"
          [attr.aria-label]="tile === 0 ? 'Empty' : 'Tile ' + tile"
          [attr.data-index]="i"
        >
          <span *ngIf="tile !== 0">{{ tile }}</span>
        </button>
      </div>

      <div class="panel-section actions">
        <div class="btn-row d-flex align-items-center">
          <button (click)="reset()">Shuffle / Reset</button>
          <button (click)="togglePause()" [disabled]="isSolved() || stopped">
            {{ paused ? "Resume" : "Pause" }}
          </button>
          <button (click)="stopGame()" [disabled]="isSolved() || stopped">
            Stop
          </button>
        </div>
      </div>
    </div>

    <aside class="right side-panel" aria-label="Game controls and stats">
      <div class="banner" *ngIf="showBanner">
        <div class="message">
          <strong>{{ isSolved() ? "Congrats!" : "Well done!" }}</strong>
          <span>
            {{ isSolved() ? "You solved it" : "Game ended" }} with
            {{ moveCount }} moves in {{ formatTime(elapsedMs) }}.
          </span>
          <span *ngIf="bestTimeMs !== null || bestMoves !== null">
            Best:
            <span class="monospace">{{
              bestTimeMs !== null ? formatTime(bestTimeMs) : "--:--:---"
            }}</span>
            <ng-container *ngIf="bestMoves !== null">
              Â· Min Moves: {{ bestMoves }}</ng-container
            >
          </span>
          <span *ngIf="newBest">New best! ðŸŽ‰</span>
        </div>
      </div>
      <div class="panel-tabs" role="tablist">
        <button
          type="button"
          role="tab"
          [attr.aria-selected]="activeTab === 'stats'"
          [class.active]="activeTab === 'stats'"
          (click)="setTab('stats')"
        >
          Stats
        </button>
        <button
          type="button"
          role="tab"
          [attr.aria-selected]="activeTab === 'leaderboard'"
          [class.active]="activeTab === 'leaderboard'"
          (click)="setTab('leaderboard')"
        >
          Leaderboard
        </button>
      </div>
      <div class="panel-section info" *ngIf="activeTab === 'stats'">
        <div class="info-grid">
          <div class="info-card player-card">
            <div class="info-label">Player</div>
            <div class="info-control player-row">
              <span class="stat-value">{{ playerName || "Guest" }}</span>
              <button type="button" class="btn-sm" (click)="askPlayerName()">
                Change
              </button>
            </div>
          </div>
          <div class="info-card moves-card">
            <div class="info-label">Moves</div>
            <div class="info-value stat-value">{{ moveCount }}</div>
          </div>
          <div class="info-card time-card">
            <div class="info-label">Time</div>
            <div class="info-value stat-value monospace">
              {{ formatTime(elapsedMs) }}
            </div>
          </div>
          <div class="info-card">
            <div class="info-label">Size</div>
            <div class="info-control">
              <select
                class="wood-select"
                title="Board size"
                autocomplete="off"
                [(ngModel)]="size"
                (ngModelChange)="changeSize($event)"
                (change)="onSelectChange($event)"
              >
                <option [value]="3">3X3</option>
                <option [value]="4">4X4</option>
                <option [value]="5">5X5</option>
              </select>
            </div>
          </div>
          <div class="info-card">
            <div class="info-label">Theme</div>
            <div class="info-control">
              <select
                class="wood-select"
                title="Theme"
                [(ngModel)]="theme"
                (ngModelChange)="changeTheme($event)"
                (change)="onSelectChange($event)"
              >
                <option value="wood">Wood</option>
                <option value="green">Green</option>
                <option value="blue">Blue</option>
                <option value="dark">Dark Gray</option>
                <option value="gray">Gray</option>
              </select>
            </div>
          </div>
        </div>
      </div>
      <div
        class="panel-section leaderboard"
        aria-label="Leaderboard"
        *ngIf="activeTab === 'leaderboard'"
      >
        <div class="panel-title">
          Leaderboard ({{ playerName || "Guest" }} Â· {{ size }}x{{ size }})
        </div>
        <ol class="lb">
          <li *ngFor="let e of leaderboard; let i = index">
            <span class="rank">#{{ i + 1 }}</span>
            <span class="time monospace">{{ formatTime(e.time) }}</span>
            <span class="moves">{{ e.moves }} moves</span>
            <span class="date">{{ e.ts | date : "shortDate" }}</span>
          </li>
          <li *ngIf="!leaderboard || leaderboard.length === 0" class="muted">
            No records yet.
          </li>
        </ol>
      </div>
    </aside>
  </div>
</div>
